#
# Hubs
#

fragment ChannelSimple on Channel {
    id
    title
    shortname
    type
    owner {
        id
        firstName
        lastName
    }
}

query Channels {
    channels {
        ...ChannelSimple
    }
}

query Channel($id: ID!) {
    channel(id: $id) {
       ...ChannelSimple
    }
}

#
# Discussions
#


fragment ParagraphSimple on Paragraph {
    ... on TextParagraph {
        text
        spans {
            ... on PostSpanBold {
                offset
                length
            }
            ... on PostSpanItalic {
                offset
                length
            }
            ... on PostSpanIrony {
                offset
                length
            }
            ... on PostSpanLink {
                offset
                length
                url
            }
        }
    }
    ... on ImageParagraph {
        url
        image {
            uuid
        }
        fileMetadata {
            isImage
            imageWidth
            imageHeight
            imageFormat
        }
    }
    ... on H1Paragraph {
        text
    }
    ... on H2Paragraph {
        text
    }
}

fragment PostDraftSimple on PostDraft {
    id
    title
    content {
       ...ParagraphSimple
    }
    publishedCopy {
        id
    }
    channel {
        id
        title
        shortname
    }
    createdAt
    updatedAt
    deletedAt
}

fragment PostSimple on Post {
    id
    title
    content {
       ...ParagraphSimple
    }
    channel {
        id
        title
        shortname
    }
    author {
        id
        name
    }

    draft {
        id
    }
    canEdit

    createdAt
    updatedAt
    deletedAt
}

query Posts($channels: [ID!]!, $after: String) {
    posts(hubs: $channels, first: 20, after: $after) {
        items {
            ...PostSimple
        }
        cursor   
    }
}

query Post($id: ID!) {
    post(id: $id) {
        ...PostSimple
    }
}

query MyPostDrafts($after: String) {
    postMyDrafts(first: 20, after: $after) {
        items {
            ...PostDraftSimple
        }
        cursor   
    }
}

query PostDraft($id: ID!) {
    postDraft(id: $id) {
        ...PostDraftSimple
    }
}

mutation PostCreateDraft {
    postDraftCreate(input: {  }) {
        ...PostDraftSimple
    }
}

mutation PostDraftUpdate($id: ID!, $channel: ID, $title: String!, $content: [PostContentInput!]) {
    postDraftUpdate(id: $id, input: { hub: $channel, title: $title, content: $content }) {
        ...PostDraftSimple
    }
}

mutation PostPublish($id: ID!) {
    postDraftPublish(id: $id) {
        ...PostSimple
    }
}