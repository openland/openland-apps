fragment MessageSender on User {
    id
    name
    photo
    isBot
    shortname
    primaryOrganization {
        id
        name
        shortname
    }
}

fragment MessageSource on MessageSourceChat {
    chat {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}

fragment MessageReactions on ModernMessageReaction {
    user {
        id
        name
    }
    reaction
}

fragment MessageSpan on MessageSpan {
    offset
    length

    ... on MessageSpanUserMention {
        user {
            id
            name
        }
    }
    ... on MessageSpanMultiUserMention {
        users {
            id
            name
        }
    }
    ... on MessageSpanOrganizationMention {
        organization {
            id
            name
        }
    }
    ... on MessageSpanRoomMention {
        room {
            ... on PrivateRoom {
                id
                user {
                    id
                    name
                }
            }
            ... on SharedRoom {
                id
                title
                isPremium
            }
        }
    }
    ... on MessageSpanLink {
        url
    }
    ... on MessageSpanDate {
        date
    }
}

fragment QuotedMessage on ModernMessage {
    id
    date
    message
    sender {
        ...MessageSender
    }
    senderBadge {
        ...UserBadge
    }
    fallback
    source {
        ...MessageSource
    }
    spans {
        ...MessageSpan
    }

    ... on GeneralMessage {
        id
        commentsCount
        edited
        attachments {
            fallback
            ... on MessageAttachmentFile {
                id
                fileId
                fileMetadata {
                    name
                    mimeType
                    size
                    isImage
                    imageWidth
                    imageHeight
                    imageFormat
                }
                filePreview
            }

            ... on MessageRichAttachment {
                id
                title
                subTitle
                titleLink
                titleLinkHostname
                text
                icon {
                    url
                    metadata {
                        name
                        mimeType
                        size
                        isImage
                        imageWidth
                        imageHeight
                        imageFormat
                    }
                }
                image {
                    url
                    metadata {
                        name
                        mimeType
                        size
                        isImage
                        imageWidth
                        imageHeight
                        imageFormat
                    }
                }
                keyboard {
                    buttons {
                        id
                        title
                        style
                        url
                    }
                }
                imageFallback {
                    photo
                    text
                }
                fallback
            }

            ... on MessageAttachmentPurchase {
                id
                purchase {
                    id
                    state
                    amount
                }
                fallback
            }
        }
    }

    ... on StickerMessage {
        id
        senderBadge {
            ...UserBadge
        }
        sticker {
            ... on ImageSticker {
                id
                pack {
                    ... on StickerPack {
                        id
                        title
                    }
                }
                image {
                    ... on ImageRef {
                        uuid
                    }
                }
            }
        }
    }
}

fragment FullMessage on ModernMessage {
    id
    date
    sender {
        ...MessageSender
    }
    senderBadge {
        ...UserBadge
    }
    message
    fallback
    source {
        ...MessageSource
    }
    spans {
        ...MessageSpan
    }
    ... on GeneralMessage {
        id
        edited
        commentsCount
        attachments {
            fallback
            ... on MessageAttachmentFile {
                id
                fileId
                fileMetadata {
                    name
                    mimeType
                    size
                    isImage
                    imageWidth
                    imageHeight
                    imageFormat
                }
                filePreview
            }

            ... on MessageRichAttachment {
                id
                title
                subTitle
                titleLink
                titleLinkHostname
                text
                icon {
                    url
                    metadata {
                        name
                        mimeType
                        size
                        isImage
                        imageWidth
                        imageHeight
                        imageFormat
                    }
                }
                image {
                    url
                    metadata {
                        name
                        mimeType
                        size
                        isImage
                        imageWidth
                        imageHeight
                        imageFormat
                    }
                }
                socialImage {
                    url
                    metadata {
                        name
                        mimeType
                        size
                        isImage
                        imageWidth
                        imageHeight
                        imageFormat
                    }
                }
                imageFallback {
                    photo
                    text
                }
                keyboard {
                    buttons {
                        id
                        title
                        style
                        url
                    }
                }
                fallback
            }
            ... on MessageAttachmentPurchase {
                id
                purchase {
                    id
                    state
                    amount
                }
                fallback
            }
        }
        quotedMessages {
            ...QuotedMessage
        }

        reactions {
            ...MessageReactions
        }
    }

    ... on StickerMessage {
        id
        commentsCount
        quotedMessages {
            ...QuotedMessage
        }
        reactions {
            ...MessageReactions
        }
        sticker {
            ...StickerFragment
        }
    }

    ... on ServiceMessage {
        id
        serviceMetadata {
            ... on InviteServiceMetadata {
                users {
                    id
                }
                invitedBy {
                    id
                }
            }

            ... on KickServiceMetadata {
                user {
                    id
                }
                kickedBy {
                    id
                }
            }

            ... on TitleChangeServiceMetadata {
                title
            }

            ... on PhotoChangeServiceMetadata {
                photo
            }

            ... on PostRespondServiceMetadata {
                respondType
            }
        }
    }
}
