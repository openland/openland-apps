query MessageMultiSpan($id: ID!) {
    message(messageId: $id) {
        id
        spans {
            ... on MessageSpanMultiUserMention {
                users {
                    ...UserSmall
                }
            }
        }
    }
}

fragment MessageUsersReactions on ModernMessageReaction {
    user {
        id
        name
        photo
        primaryOrganization {
            id
            name
        }
    }
    reaction
}

query MessageFullReactions($id: ID!) {
    message(messageId: $id) {
        id
        ... on GeneralMessage {
            id
            reactions {
                ...MessageUsersReactions
            }
        }
        ... on StickerMessage {
            id
            reactions {
                ...MessageUsersReactions
            }
        }
    }
}

fragment MessageSender on User {
    id
    name
    photo
    isBot
    shortname
    inContacts
    primaryOrganization {
        id
        name
        shortname
    }
}

fragment MessageReactionCounter on ReactionCounter {
    reaction
    count
    setByMe
}

fragment MessageSpan on MessageSpan {
    offset
    length

    ... on MessageSpanUserMention {
        user {
            id
            name
        }
    }
    ... on MessageSpanMultiUserMention {
        offset
        length
    }
    ... on MessageSpanOrganizationMention {
        organization {
            id
            name
        }
    }
    ... on MessageSpanRoomMention {
        room {
            ... on PrivateRoom {
                id
                user {
                    id
                    name
                }
            }
            ... on SharedRoom {
                id
                title
                isPremium
            }
        }
    }
    ... on MessageSpanLink {
        url
    }
    ... on MessageSpanDate {
        date
    }
}

fragment MessageAttachments on ModernMessageAttachment {
    fallback
    ... on MessageAttachmentFile {
        id
        fileId
        fileMetadata {
            name
            mimeType
            size
            isImage
            imageWidth
            imageHeight
            imageFormat
        }
        filePreview
        previewFileId
        previewFileMetadata {
            name
            mimeType
            size
            isImage
            imageWidth
            imageHeight
            imageFormat
        }
        videoMetadata {
            duration
        }
    }

    ... on MessageRichAttachment {
        id
        title
        subTitle
        titleLink
        titleLinkHostname
        text
        featuredIcon
        icon {
            url
            metadata {
                name
                mimeType
                size
                isImage
                imageWidth
                imageHeight
                imageFormat
            }
        }
        image {
            url
            metadata {
                name
                mimeType
                size
                isImage
                imageWidth
                imageHeight
                imageFormat
            }
        }
        socialImage {
            url
            metadata {
                name
                mimeType
                size
                isImage
                imageWidth
                imageHeight
                imageFormat
            }
        }
        imageFallback {
            photo
            text
        }
        keyboard {
            buttons {
                id
                title
                style
                url
            }
        }
        fallback
    }
    ... on MessageAttachmentPurchase {
        id
        purchase {
            id
            state
            amount
        }
        fallback
    }
}

fragment ServiceMessageMetadata on ServiceMetadata {
    ... on InviteServiceMetadata {
        users {
            id
        }
        invitedBy {
            id
        }
    }

    ... on KickServiceMetadata {
        user {
            id
        }
        kickedBy {
            id
        }
    }

    ... on TitleChangeServiceMetadata {
        title
    }

    ... on PhotoChangeServiceMetadata {
        photo
    }

    ... on PostRespondServiceMetadata {
        respondType
    }
}

fragment QuotedMessage on ModernMessage {
    id
    date
    message
    sender {
        ...MessageSender
    }
    senderBadge {
        ...UserBadge
    }
    fallback
    source {
        ... on MessageSourceChat {
            chat {
                ... on PrivateRoom {
                    id
                }
                ... on SharedRoom {
                    id
                    isChannel
                    membersCount
                }
            }
        }
    }
    spans {
        ...MessageSpan
    }

    ... on GeneralMessage {
        id
        edited
        commentsCount
        attachments {
            ...MessageAttachments
        }
    }

    ... on StickerMessage {
        id
        sticker {
            ...StickerFragment
        }
    }
}

fragment FullMessage on ModernMessage {
    id
    seq
    date
    sender {
        ...MessageSender
    }
    senderBadge {
        ...UserBadge
    }
    message
    fallback
    source {
        ... on MessageSourceChat {
            chat {
                ... on PrivateRoom {
                    id
                    user {
                        id
                    }
                }
                ... on SharedRoom {
                    id
                    title
                    isChannel
                    membersCount
                }
            }
        }
    }
    spans {
        ...MessageSpan
    }
    ... on GeneralMessage {
        id
        edited
        commentsCount
        attachments {
            ...MessageAttachments
        }
        quotedMessages {
            ...QuotedMessage
        }
        reactionCounters {
            ...MessageReactionCounter
        }
        overrideAvatar {
            uuid
            crop {
                x
                y
                w
                h
            }
        }
        overrideName
    }

    ... on StickerMessage {
        id
        commentsCount
        quotedMessages {
            ...QuotedMessage
        }
        sticker {
            ...StickerFragment
        }
        reactionCounters {
            ...MessageReactionCounter
        }
        overrideAvatar {
            uuid
            crop {
                x
                y
                w
                h
            }
        }
        overrideName
    }

    ... on ServiceMessage {
        id
        serviceMetadata {
            ...ServiceMessageMetadata
        }
    }
}

fragment FullMessageWithoutSource on ModernMessage {
    id
    seq
    date
    sender {
        ...MessageSender
    }
    senderBadge {
        ...UserBadge
    }
    message
    fallback
    spans {
        ...MessageSpan
    }
    ... on GeneralMessage {
        id
        edited
        commentsCount
        attachments {
            ...MessageAttachments
        }
        quotedMessages {
            ...QuotedMessage
        }
        reactionCounters {
            ...MessageReactionCounter
        }
        overrideAvatar {
            uuid
            crop {
                x
                y
                w
                h
            }
        }
        overrideName
    }

    ... on StickerMessage {
        id
        commentsCount
        quotedMessages {
            ...QuotedMessage
        }
        sticker {
            ...StickerFragment
        }
        reactionCounters {
            ...MessageReactionCounter
        }
        overrideAvatar {
            uuid
            crop {
                x
                y
                w
                h
            }
        }
        overrideName
    }

    ... on ServiceMessage {
        id
        serviceMetadata {
            ...ServiceMessageMetadata
        }
    }
}
