fragment ChatUpdateFragment on ChatUpdate {
    ... on ChatMessageReceived {
        message {
            ...FullMessage
        }
        repeatKey
    }
    ... on ChatMessageUpdated {
        message {
            ...FullMessage
        }
    }
    ... on ChatMessageDeleted {
        message {
            id
        }
    }
    ... on ChatUpdated {
        chat {
            ...RoomShort
        }
    }
    ... on ChatLostAccess {
        lostAccess
    }
}
subscription ChatWatch($chatId: ID!, $state: String) {
    event: chatUpdates(chatId: $chatId, fromState: $state) {
        ... on ChatUpdateSingle {
            seq
            state
            update {
                ...ChatUpdateFragment
            }
        }
        ... on ChatUpdateBatch {
            fromSeq
            seq
            state
            updates {
                ...ChatUpdateFragment
            }
        }
    }
}
query RoomPico($id: ID!) {
    room(id: $id) {
        ...RoomNano
    }
}
query RoomChat($id: ID!) {
    room(id: $id) {
        ... on PrivateRoom {
            id
            user {
                id
                name
                firstName
                photo
                shortname
                inContacts
                primaryOrganization {
                    id
                    name
                }
                isBot
                isYou
                online
                lastSeen
                isBanned
                isMeBanned
            }
            pinnedMessage {
                ...FullMessage
            }
            settings {
                id
                mute
            }
            myBadge {
                ...UserBadge
            }
        }
        ... on SharedRoom {
            id
            kind
            title
            membership
            isChannel
            role
            canEdit
            canSendMessage
            photo
            membersCount
            shortname
            featuredMembersCount
            socialImage
            featured
            welcomeMessage {
                isOn
                sender {
                    id
                    name
                }
                message
            }
            organization {
                ...OrganizationMedium
            }
            canUnpinMessage
            pinnedMessage {
                ...FullMessage
            }
            myBadge {
                ...UserBadge
            }
            settings {
                id
                mute
            }
            description
            previewMembers {
                id
                photo
                name
            }
            isPremium
            premiumPassIsActive
            premiumSubscription {
                id
                state
            }
            premiumSettings {
                id
                price
                interval
            }
            owner {
                id
                firstName
                isYou
            }
            serviceMessageSettings {
                joinsMessageEnabled
                leavesMessageEnabled
            }
            callSettings {
                mode
                callLink
            }
            repliesEnabled
        }
    }
}
query RoomFeaturedMembers($roomId: ID!) {
    roomFeaturedMembers(roomId: $roomId) {
        user {
            ...UserShort
        }
        role
        membership
        canKick
        badge {
            ...UserBadge
        }
    }
}
query RoomTiny($id: ID!) {
    room(id: $id) {
        ...RoomShort
    }
}

query RoomSuper($id: ID!) {
    roomSuper(id: $id) {
        id
        featured
    }
}

mutation PinMessage($chatId: ID!, $messageId: ID!) {
    pinMessage: gammaPinMessage(chatId: $chatId, messageId: $messageId) {
        ...RoomShort
    }
}
mutation UnpinMessage($chatId: ID!) {
    unpinMessage: gammaUnpinMessage(chatId: $chatId) {
        ...RoomShort
    }
}
mutation MessageSetReaction($messageId: ID!, $reaction: MessageReactionType!) {
    messageReactionAdd(messageId: $messageId, reaction: $reaction)
}
mutation MessageUnsetReaction($messageId: ID!, $reaction: MessageReactionType!) {
    messageReactionRemove(messageId: $messageId, reaction: $reaction)
}
mutation MessageSetDonationReaction($messageId: ID!) {
    messageDonationReactionAdd(messageId: $messageId)
}
query GlobalCounter {
    alphaNotificationCounter {
        id
        unreadCount
    }
}
query MessagesBatch($chatId: ID!, $first: Int!, $before: ID, $after: ID) {
    gammaMessages(chatId: $chatId, first: $first, before: $before, after: $after) {
        messages {
            ...FullMessage
        }
        haveMoreForward
        haveMoreBackward
    }
    state: conversationState(id: $chatId) {
        state
    }
}
query ChatInit($chatId: ID!, $before: ID, $first: Int!) {
    messages(chatId: $chatId, first: $first, before: $before) {
        ...FullMessage
    }
    state: conversationState(id: $chatId) {
        state
    }
    room(id: $chatId) {
        ...RoomShort
    }
    lastReadedMessage(chatId: $chatId) {
        id
    }
}
query ChatInitFromUnread($chatId: ID!, $before: ID, $first: Int!) {
    gammaMessages(chatId: $chatId, first: $first, before: $before) {
        messages {
            ...FullMessage
        }
        haveMoreForward
        haveMoreBackward
    }
    state: conversationState(id: $chatId) {
        state
    }
    room(id: $chatId) {
        ...RoomShort
    }
    lastReadedMessage(chatId: $chatId) {
        id
    }
}
mutation SendMessage(
    $chatId: ID!
    $message: String
    $replyMessages: [ID!]
    $mentions: [MentionInput!]
    $fileAttachments: [FileAttachmentInput!]
    $spans: [MessageSpanInput!]
    $repeatKey: String
) {
    sentMessage: sendMessage(
        chatId: $chatId
        message: $message
        replyMessages: $replyMessages
        mentions: $mentions
        fileAttachments: $fileAttachments
        spans: $spans
        repeatKey: $repeatKey
    )
}
mutation RoomRead($id: ID!, $mid: ID!) {
    roomRead(id: $id, mid: $mid)
}
mutation RoomCreate(
    $kind: SharedRoomKind!
    $members: [ID!]!
    $message: String
    $title: String
    $description: String
    $photoRef: ImageRefInput
    $organizationId: ID
    $channel: Boolean!
    $price: Int
    $interval: WalletSubscriptionInterval
) {
    room: betaRoomCreate(
        kind: $kind
        members: $members
        message: $message
        title: $title
        description: $description
        photoRef: $photoRef
        organizationId: $organizationId
        channel: $channel
        price: $price
        interval: $interval
    ) {
        id
    }
}
mutation BuyPremiumChatSubscription($chatId: ID!) {
    betaBuyPremiumChatSubscription(chatId: $chatId) {
        id
        premiumPassIsActive
        premiumSubscription {
            id
            state
        }
        membership
    }
}
mutation BuyPremiumChatPass($chatId: ID!) {
    betaBuyPremiumChatPass(chatId: $chatId) {
        id
        premiumPassIsActive
        membership
    }
}

mutation SetTyping($conversationId: ID!, $type: TypingType!) {
    typingSend(conversationId: $conversationId, type: $type)
}
mutation UnsetTyping($conversationId: ID!) {
    typingCancel(conversationId: $conversationId)
}
mutation RoomAddMembers($roomId: ID!, $invites: [RoomInviteInput!]!) {
    alphaRoomInvite(roomId: $roomId, invites: $invites) {
        user {
            ...UserShort
        }
        role
        membership
        canKick
        badge {
            ...UserBadge
        }
    }
}
mutation RoomKick($roomId: ID!, $userId: ID!) {
    betaRoomKick(roomId: $roomId, userId: $userId) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}
mutation RoomChangeRole($roomId: ID!, $userId: ID!, $newRole: RoomMemberRole!) {
    betaRoomChangeRole(roomId: $roomId, userId: $userId, newRole: $newRole) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}
mutation RoomLeave($roomId: ID!) {
    betaRoomLeave(roomId: $roomId) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}
query RoomSearch($query: String, $sort: String, $page: Int) {
    items: betaRoomSearch(query: $query, sort: $sort, page: $page, first: 25) {
        edges {
            node {
                ... on SharedRoom {
                    id
                    kind
                    isChannel
                    title
                    photo
                    membership
                    membersCount
                    organization {
                        id
                        photo
                        name
                    }
                }
            }
            cursor
        }
        pageInfo {
            hasNextPage
            hasPreviousPage
            itemsCount
            currentPage
            pagesCount
            openEnded
        }
    }
}
query RoomMembersShort($roomId: ID!) {
    members: roomMembers(roomId: $roomId) {
        user {
            id
        }
    }
}
query RoomMembersTiny($roomId: ID!) {
    members: roomMembers(roomId: $roomId) {
        user {
            id
            name
            shortname
            photo
            primaryOrganization {
                id
                name
            }
        }
    }
}
query RoomAdminMembers($roomId: ID!) {
    roomAdmins(roomId: $roomId) {
        user {
            ...UserShort
        }
    }
}
query RoomMembersPaginated($roomId: ID!, $first: Int, $after: ID) {
    members: roomMembers(roomId: $roomId, first: $first, after: $after) {
        user {
            ...UserShort
        }
        role
        membership
        canKick
        badge {
            ...UserBadge
        }
    }
}

query RoomMembersSearch($cid: ID!, $query: String, $first: Int!, $after: String) {
    chatMembersSearch(cid: $cid, query: $query, first: $first, after: $after) {
        edges {
            node {
                user {
                    ...UserShort
                }
                role
                membership
                canKick
                badge {
                    ...UserBadge
                }
            }
            cursor
        }
        pageInfo {
            hasNextPage
        }
    }
}

mutation RoomSettingsUpdate($settings: RoomUserNotificaionSettingsInput!, $roomId: ID!) {
    betaRoomUpdateUserNotificationSettings(settings: $settings, roomId: $roomId) {
        id
        mute
    }
}

mutation RoomAlterFeatured($id: ID!, $featured: Boolean!) {
    betaRoomAlterFeatured(roomId: $id, featured: $featured) {
        id
        featured
    }
}

mutation RoomJoin($roomId: ID!) {
    join: betaRoomJoin(roomId: $roomId) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}
mutation RoomsJoin($roomsIds: [ID!]!) {
    join: betaRoomsJoin(roomsIds: $roomsIds) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
        }
    }
}
mutation RoomsInviteUser($userId: ID!, $roomIds: [ID!]!) {
    rooms: betaRoomsInviteUser(userId: $userId, roomIds: $roomIds) {
        ...RoomShort
    }
}
mutation RoomJoinInviteLink($invite: String!) {
    join: betaRoomInviteLinkJoin(invite: $invite) {
        ...RoomShort
    }
}
mutation RoomRenewInviteLink($roomId: ID!) {
    link: betaRoomInviteLinkRenew(roomId: $roomId)
}
query RoomInviteLink($roomId: ID!) {
    link: betaRoomInviteLink(roomId: $roomId)
}
query RoomInviteInfo($invite: String!) {
    invite: betaRoomInviteInfo(invite: $invite) {
        id
        room {
            ... on SharedRoom {
                id
                kind
                isChannel
                title
                photo
                socialImage
                description
                featured
                organization {
                    ...OrganizationShort
                }
                membership
                membersCount
                previewMembers {
                    id
                    photo
                    name
                }
                isPremium
                premiumPassIsActive
                premiumSubscription {
                    id
                    state
                }
                premiumSettings {
                    id
                    price
                    interval
                }
                owner {
                    id
                    firstName
                }
            }
        }
        invitedByUser {
            ...UserShort
        }
    }
}
query ResolvedInvite($key: String!) {
    invite: alphaResolveInvite(key: $key) {
        __typename
        ... on InviteInfo {
            id
            orgId
            title
            creator {
                ...UserShort
            }
            organization {
                id
                photo
                name
                membersCount
                about
                isMine
                isCommunity: alphaIsCommunity
                featured: alphaFeatured
            }
        }
        ... on AppInvite {
            inviter {
                ...UserShort
            }
        }
        ... on RoomInvite {
            id
            invitedByUser {
                ...UserShort
            }

            room {
                ... on SharedRoom {
                    id
                    kind
                    isChannel
                    title
                    photo
                    socialImage
                    description
                    membership
                    membersCount
                    featured
                    previewMembers {
                        id
                        photo
                        name
                    }
                    isPremium
                    premiumPassIsActive
                    premiumSubscription {
                        id
                        state
                    }
                    premiumSettings {
                        id
                        price
                        interval
                    }
                    owner {
                        id
                        firstName
                    }
                }
            }
        }
    }
    shortnameItem: alphaResolveShortName(shortname: $key) {
        ... on SharedRoom {
            ... SharedRoomPreview
        }
    }
}
mutation RoomUpdate($roomId: ID!, $input: RoomUpdateInput!) {
    betaRoomUpdate(roomId: $roomId, input: $input) {
        ... on PrivateRoom {
            id
        }
        ... on SharedRoom {
            id
            title
            photo
            description
            socialImage
            repliesEnabled
        }
    }
}
mutation RoomDeleteMessage($messageId: ID!) {
    betaMessageDelete(mid: $messageId)
}
mutation RoomDeleteMessages($mids: [ID!]!) {
    betaMessageDelete(mids: $mids)
}
mutation RoomDeleteUrlAugmentation($messageId: ID!) {
    betaMessageDeleteAugmentation(mid: $messageId)
}

mutation RoomDelete($chatId: ID!) {
  deleteChat(chatId: $chatId)
}

mutation EditMessage(
    $messageId: ID!
    $message: String
    $replyMessages: [ID!]
    $mentions: [MentionInput!]
    $fileAttachments: [FileAttachmentInput!]
    $spans: [MessageSpanInput!]
) {
    editMessage(
        messageId: $messageId
        message: $message
        replyMessages: $replyMessages
        mentions: $mentions
        fileAttachments: $fileAttachments
        spans: $spans
    )
}

subscription TypingsWatch {
    typings {
        conversation: chat {
            ... on PrivateRoom {
                id
            }
            ... on SharedRoom {
                id
            }
        }
        user {
            id
            photo
            firstName
        }
        cancel
        type
    }
}
subscription ChatOnlinesCountWatch($chatId: ID!) {
    chatOnlinesCount(chatId: $chatId) {
        onlineMembers
    }
}
mutation UpdateWelcomeMessage(
    $roomId: ID!
    $welcomeMessageIsOn: Boolean!
    $welcomeMessageSender: ID
    $welcomeMessageText: String
) {
    updateWelcomeMessage(
        roomId: $roomId
        welcomeMessageIsOn: $welcomeMessageIsOn
        welcomeMessageSender: $welcomeMessageSender
        welcomeMessageText: $welcomeMessageText
    )
}
query Message($messageId: ID!) {
    message(messageId: $messageId) {
        ...FullMessageWithoutSource

        source {
            ... on MessageSourceChat {
                chat {
                    ... on PrivateRoom {
                        id
                        user {
                            id
                            isBot
                        }
                        pinnedMessage {
                            id
                        }
                    }
                    ... on SharedRoom {
                        id
                        title
                        isChannel
                        membersCount
                        canSendMessage
                        canEdit
                        repliesEnabled
                        pinnedMessage {
                            id
                        }
                        role
                    }
                }
            }
        }
    }
    comments(peerId: $messageId) {
        id
        subscription {
            type
        }
    }
}
query MessagesSearch($query: String!, $sort: String, $first: Int!, $after: String, $cid: ID) {
    messagesSearch(query: $query, sort: $sort, first: $first, after: $after, cid: $cid) {
        edges {
            node {
                chat {
                    ... on PrivateRoom {
                        id
                        user {
                            id
                            name
                            photo
                        }
                        settings {
                            id
                            mute
                        }
                    }
                    ... on SharedRoom {
                        id
                        kind
                        title
                        membership
                        isChannel
                        role
                        canEdit
                        photo
                        featured
                        settings {
                            id
                            mute
                        }
                    }
                }
                message {
                    id
                    date
                    sender {
                        id
                        name
                        firstName
                        photo
                    }
                    senderBadge {
                        ...UserBadge
                    }
                    message
                    fallback
                    ... on GeneralMessage {
                        id
                        attachments {
                            id
                            fallback
                            ... on MessageAttachmentFile {
                                id
                                fileId
                                fileMetadata {
                                    isImage
                                    imageFormat
                                }
                            }
                        }
                        quotedMessages {
                            id
                        }
                    }
                }
            }
            cursor
        }
        pageInfo {
            hasNextPage
            hasPreviousPage
            itemsCount
            currentPage
            pagesCount
            openEnded
        }
    }
}
query MessagesSearchFull($query: String!, $sort: String, $first: Int!, $after: String, $cid: ID) {
    messagesSearch(query: $query, sort: $sort, first: $first, after: $after, cid: $cid) {
        edges {
            node {
                chat {
                    ... on PrivateRoom {
                        id
                        user {
                            id
                            name
                            photo
                        }
                        settings {
                            id
                            mute
                        }
                    }
                    ... on SharedRoom {
                        id
                        kind
                        title
                        membership
                        isChannel
                        role
                        canEdit
                        photo
                        settings {
                            id
                            mute
                        }
                    }
                }
                message {
                    ...FullMessage
                }
            }
            cursor
        }
        pageInfo {
            hasNextPage
            hasPreviousPage
            itemsCount
            currentPage
            pagesCount
            openEnded
        }
    }
}

query ChatJoin($id: ID!) {
    room(id: $id) {
        ... on SharedRoom {
            id
            title
            description
            photo
            membersCount
            previewMembers {
                id
                photo
                name
            }
            isChannel
            isPremium
            premiumPassIsActive
            premiumSubscription {
                id
                state
            }
            premiumSettings {
                id
                price
                interval
            }
            owner {
                id
                firstName
            }
        }
    }
}

query CommonChatsWithUser($uid: ID!, $first: Int!, $after: ID) {
    commonChatsWithUser(uid: $uid, first: $first, after: $after) {
        items {
            id
            title
            description
            photo
            membersCount
            featured
        }
        cursor
        count
    }
}