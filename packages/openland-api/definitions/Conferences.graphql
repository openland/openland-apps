fragment ConferenceFull on Conference {
    id
    startTime
    peers {
        id
        user {
            ...UserShort
        }
    }
    iceServers {
        urls
        username
        credential
    }
    room {
        __typename
        ...on SharedRoom {
            id
            title
            isChannel
            membersCount
            photo
        }
        ...on PrivateRoom {
            id
            user {
                id
                name
                photo
            }
        }
    }
}
fragment ConferenceShort on Conference {
    id
    startTime
    iceServers {
        urls
        username
        credential
    }
}

fragment MediaStreamFull on MediaStream {
    id

    seq
    state
    sdp
    
    ice
    iceTransportPolicy

    receivers {
        peerId
        kind
        videoSource
        mid
    }
    senders {
        kind
        videoSource
        codecParams
        mid
    }
}

query Conference($id: ID!) {
    conference(id: $id) {
        ...ConferenceFull
    }
}

query ConferenceMedia($id: ID!, $peerId: ID!) {
    conferenceMedia(id: $id, peerId: $peerId) {
        id
        streams{
            ...MediaStreamFull
        }
        iceServers {
            urls
            username
            credential
        }
    }
}
mutation ConferenceJoin($id: ID!) {
    conferenceJoin(id: $id) {
        peerId
        conference {
            ...ConferenceShort
        }
    }
}

mutation conferenceAddScreenShare($id: ID!){
    conferenceAddScreenShare(id: $id) {
        ...ConferenceShort
    }
}
mutation conferenceRemoveScreenShare($id: ID!){
    conferenceRemoveScreenShare(id: $id) {
        ...ConferenceShort
    }
}
mutation conferenceAlterMediaState($id: ID!, $state: MediaStreamMediaStateInput!){
    conferenceAlterMediaState(id: $id, state: $state) {
        ...ConferenceShort
    }
}

mutation conferenceRequestLocalMediaChange($id: ID!, $media: LocalMediaInput!){
    conferenceRequestLocalMediaChange(id: $id, media: $media) {
        ...ConferenceShort
    }
}
mutation ConferenceLeave($id: ID!, $peerId: ID!) {
    conferenceLeave(id: $id, peerId: $peerId) {
        ...ConferenceShort
    }
}
mutation ConferenceKeepAlive($id: ID!, $peerId: ID!) {
    conferenceKeepAlive(id: $id, peerId: $peerId) {
        ...ConferenceShort
    }
}
mutation MediaOffer($id: ID!, $peerId: ID!, $offer: String!, $seq: Int!, $hints: [MediaStreamHint!]) {
    mediaStreamOffer(id: $id, peerId: $peerId, offer: $offer, seq: $seq, hints: $hints) {
        id
        streams{
            ...MediaStreamFull
        }
    }
}
mutation MediaAnswer($id: ID!, $peerId: ID!, $answer: String!, $seq: Int!) {
    mediaStreamAnswer(id: $id, peerId: $peerId, answer: $answer, seq: $seq) {
        id
        streams{
            ...MediaStreamFull
        }
    }
}
mutation MediaCandidate($id: ID!, $peerId: ID!, $candidate: String!) {
    mediaStreamCandidate(id: $id, peerId: $peerId, candidate: $candidate) {
        id
        streams{
            ...MediaStreamFull
        }
    }
}

subscription ConferenceMediaWatch($id: ID!, $peerId: ID!) {
    media: alphaConferenceMediaWatch(id: $id, peerId: $peerId) {
        id
        streams{
            ...MediaStreamFull
        }
        localMedia{
            id
            sendVideo
            sendAudio
            sendScreencast
        }
    }
}
subscription ConferenceWatch($id: ID!) {
    alphaConferenceWatch(id: $id) {
        ...ConferenceFull
    }
}
