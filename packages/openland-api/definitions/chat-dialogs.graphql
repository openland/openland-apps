query Dialogs($after: String) {
    dialogs(first: 20, after: $after) {
        items {
            ...DialogFragment
        }
        cursor
    }
    state: dialogsState {
        state
    }
    counter: alphaNotificationCounter {
        id
        unreadCount
    }
}

fragment DialogFragment on Dialog {
    id
    cid
    fid
    kind
    isChannel
    isPremium
    title
    photo
    unreadCount
    isMuted
    hasActiveCall
    haveMention
    topMessage: alphaTopMessage {
        ...DialogMessage
    }
    membership
}

fragment DialogMessage on ModernMessage {
    id
    date
    sender {
        id
        name
        photo
        firstName
    }
    message
    fallback
    ... on GeneralMessage {
        id
        quotedMessages {
            id
        }
    }
}

subscription DialogsWatch($state: String) {
    event: dialogsUpdates(fromState: $state) {
        ... on DialogUpdateSingle {
            state
            update {
                ...DialogUpdateFragment
            }
        }
        ... on DialogUpdateBatch {
            state
            updates {
                ...DialogUpdateFragment
            }
        }
    }
}

fragment DialogUpdateFragment on DialogUpdate {
    ... on DialogMessageReceived {
        cid
        unread
        globalUnread
        message: alphaMessage {
            ...DialogMessage
            ... on ServiceMessage {
                id
                serviceMetadata {
                    __typename
                }
            }
        }
        haveMention
        silent {
            mobile
            desktop
        }
        showNotification {
            mobile
            desktop
        }
        membership
    }
    ... on DialogMessageUpdated {
        cid
        message: alphaMessage {
            ...DialogMessage
        }
        haveMention
    }
    ... on DialogMessageDeleted {
        cid
        message: alphaMessage {
            ...DialogMessage
        }
        prevMessage: alphaPrevMessage {
            ...DialogMessage
        }
        unread
        globalUnread
        haveMention
    }
    ... on DialogMessageRead {
        cid
        mid
        unread
        globalUnread
        haveMention
    }
    ... on DialogMuteChanged {
        cid
        mute
    }
    ... on DialogPeerUpdated {
        cid
        peer {
            ... on PrivateRoom {
                id
                user {
                    id
                    name
                    photo
                }
            }
            ... on SharedRoom {
                id
                title
                photo
            }
        }
    }
    ... on DialogDeleted {
        cid
        globalUnread
    }
    ... on DialogBump {
        cid
        globalUnread
        unread
        topMessage {
            ...DialogMessage
            ... on ServiceMessage {
                id
                serviceMetadata {
                    __typename
                }
            }
        }
        haveMention
        membership
    }
    ... on DialogCallStateChanged {
        cid
        hasActiveCall
    }
}
